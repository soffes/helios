- id: bathroom_fan_up
  alias: Bathroom Fan - Up
  mode: single
  trigger:
    - trigger: state
      entity_id: event.bathroom_fan_switch_up
  action:
    - action: light.turn_on
      target:
        entity_id: light.bathroom_fan_switch_led
      data:
        rgb_color: [255, 255, 255]

- id: bathroom_fan_down
  alias: Bathroom Fan - Down
  mode: single
  trigger:
    - trigger: state
      entity_id: event.bathroom_fan_switch_down
  action:
    - action: timer.cancel
      target:
        entity_id: timer.bathroom_fan
    - action: light.turn_off
      target:
        entity_id: light.bathroom_fan_switch_led

- id: bathroom_fan_on
  alias: Bathroom Fan - On
  mode: single
  trigger:
    - trigger: state
      entity_id: fan.bathroom
      to: "on"
  action:
    - action: timer.cancel
      entity_id: timer.bathroom_fan

- id: bathroom_fan_off
  alias: Bathroom Fan - Off
  mode: single
  trigger:
    - trigger: state
      entity_id: fan.bathroom
      to: "off"
    - trigger: state
      entity_id: timer.bathroom_fan
      to: idle
  action:
    - action: light.turn_off
      target:
        entity_id: light.bathroom_fan_switch_led

- id: bathroom_fan_start_timer
  alias: Bathroom Fan - Start Timer
  mode: single
  trigger:
    - trigger: state
      entity_id: event.bathroom_switch_down
  condition:
    - condition: state
      entity_id:
        - fan.bathroom
      state: "on"
  action:
    - action: timer.start
      target:
        entity_id: timer.bathroom_fan

- id: bathroom_fan_timer_active
  alias: Bathroom Fan - Timer Active
  mode: single
  trigger:
    - trigger: state
      entity_id: timer.bathroom_fan
      to: active
  action:
    - action: light.turn_on
      target:
        entity_id: light.bathroom_fan_switch_led
      data:
        brightness: 255
        rgb_color: [0, 255, 0]

- id: bathroom_fan_timer_finished
  alias: Bathroom Fan - Timer Finished
  mode: single
  trigger:
    - trigger: event
      event_type: timer.finished
      event_data:
        entity_id: timer.bathroom_fan
  action:
    - action: fan.turn_off
      target:
        entity_id: fan.bathroom
    - action: light.turn_off
      target:
        entity_id: light.bathroom_fan_switch_led

# Toggle skylight
- id: bathroom_fan_config
  alias: Bathroom Fan - Config
  mode: single
  trigger:
    - trigger: state
      entity_id: event.bathroom_fan_switch_config
  action:
    - action: cover.toggle
      target:
        entity_id: cover.bathroom_skylight
